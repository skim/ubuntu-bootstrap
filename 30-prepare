#!/usr/bin/env python
import bootstrap as bs


bs.fheadline("BS PREPARE", desc="configure base system")
conf = bs.config()


bs.tofile("""
deb {0} {1} main multiverse restricted universe
deb-src {0} {1} main multiverse restricted universe
deb {0} {1}-updates main multiverse restricted universe
deb-src {0} {1}-updates main multiverse restricted universe
""".format(conf.repository, conf.release).strip(),
    bs.workpath(conf, "/etc/apt/sources.list"), sudo=True)


bs.tofile("""
127.0.0.1 localhost
127.0.1.1 {0}

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ff02::3 ip6-allhosts
""".format(conf.hostname).strip(), bs.workpath(conf, "/etc/hosts"), sudo=True)


installfile = "/10-install"
bs.tofile("""
#!/usr/bin/env bash
apt-get -y update
apt-get -y dist-upgrade
apt-get -y install {0}
apt-get -y install grub
apt-get -y install {1}
""".format(conf.kernel, bs.removespace(conf.packages).replace(",", " ")),
    bs.workpath(conf, installfile), sudo=True, readable=False)
bs.sub("sudo chmod +x %s" % bs.workpath(conf, installfile))
